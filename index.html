<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ujian Informatika Kelas 7 (Bab 1 - Berpikir Komputasional)</title>
  <script src="tailwind.js"></script>
  <style>
    body, html { height: 100%; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
    .question-card { transition: all 0.3s ease; }
    .option-button { transition: all 0.2s ease; }
    .option-button:hover { transform: translateX(4px); }
    .timer-warning { animation: pulse 1s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }
  </style>
</head>
<body class="h-full bg-sky-50">
  <div id="app" class="h-full"></div>

  <script>
    // ===================== KONFIGURASI =====================
    const config = {
      exam_title: "Penilaian Bab 1 - Berpikir Komputasional",
      school_name: "SMP Negeri 1 Gunungguruh",
      subject_info: "Informatika Kelas 7",
      background_color: "#f0f9ff",
      guru_pin: "1234"
    };

    // ===================== SOAL BAB 1 =====================
    let questions = [
      {question:"Apa yang dimaksud dengan berpikir komputasional?",options:[
        "Cara berpikir menggunakan komputer untuk menyelesaikan masalah",
        "Cara berpikir logis dan sistematis dalam memecahkan masalah",
        "Cara berpikir untuk menghafal kode program",
        "Cara berpikir dengan meniru komputer"],correct:1},
      {question:"Langkah pertama dalam berpikir komputasional adalah...",options:[
        "Abstraksi","Pengenalan pola","Dekomposisi","Membuat algoritma"],correct:2},
      {question:"Apa yang dimaksud dengan dekomposisi?",options:[
        "Mengabaikan hal-hal yang tidak penting",
        "Menggabungkan semua bagian masalah",
        "Mengenali pola-pola dalam masalah",
        "Memecah masalah besar menjadi bagian-bagian kecil"],correct:3},
      {question:"Tujuan dari mengenali pola (pattern recognition) adalah...",options:[
        "Membuat algoritma lebih panjang",
        "Menemukan kesamaan untuk mempermudah penyelesaian masalah",
        "Menghapus data yang tidak relevan",
        "Meningkatkan kecepatan komputer"],correct:1},
      {question:"Abstraksi dalam berpikir komputasional berarti...",options:[
        "Menghapus semua data",
        "Menambahkan detail kecil pada masalah",
        "Mengabaikan detail yang tidak penting dan fokus pada inti masalah",
        "Membuat algoritma tanpa berpikir"],correct:2},
      {question:"Apa itu algoritma?",options:[
        "Bahasa pemrograman untuk komputer",
        "Langkah-langkah logis untuk menyelesaikan masalah",
        "Hasil akhir dari berpikir komputasional",
        "Urutan angka dan huruf"],correct:1},
      {question:"Contoh penerapan berpikir komputasional dalam kehidupan sehari-hari adalah...",options:[
        "Menyalin pekerjaan teman",
        "Menyusun langkah-langkah memasak makanan",
        "Menggambar tanpa rencana",
        "Menebak jawaban tanpa berpikir"],correct:1},
      {question:"Langkah terakhir dalam berpikir komputasional adalah...",options:[
        "Menganalisis pola",
        "Membuat algoritma atau solusi",
        "Melakukan dekomposisi ulang",
        "Menghapus abstraksi"],correct:1},
      {question:"Berikut ini yang bukan termasuk komponen berpikir komputasional adalah...",options:[
        "Dekomposisi","Abstraksi","Pengenalan pola","Menghafal perintah komputer"],correct:3},
      {question:"Mengapa berpikir komputasional penting dipelajari?",options:[
        "Agar siswa dapat menjadi ahli komputer",
        "Agar dapat memecahkan masalah dengan cara sistematis dan efisien",
        "Agar dapat membuat robot",
        "Agar dapat menggunakan internet dengan cepat"],correct:1}
    ];

    // ===================== FUNGSI ACAK =====================
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function shuffleQuestions() {
      // acak urutan soal
      questions = shuffleArray(questions.map(q => {
        // acak juga urutan opsi tiap soal
        const opts = q.options.map((o, i) => ({text: o, isCorrect: i === q.correct}));
        const shuffled = shuffleArray(opts);
        return {
          question: q.question,
          options: shuffled.map(o => o.text),
          correct: shuffled.findIndex(o => o.isCorrect)
        };
      }));
    }

    // ===================== STATE GLOBAL =====================
    let state = {
      screen: 'start',
      studentName: '',
      studentClass: '',
      current: 0,
      answers: new Array(questions.length).fill(null),
      timeLeft: 600,
      timer: null,
      locked: false
    };

    // ===================== UTILITAS =====================
    function formatTime(s){const m=Math.floor(s/60),sec=s%60;return `${m}:${sec.toString().padStart(2,'0')}`;}
    function startTimer(){state.timer=setInterval(()=>{state.timeLeft--;const t=document.getElementById('timer');if(t){t.textContent=formatTime(state.timeLeft);if(state.timeLeft<=60)t.classList.add('timer-warning');}if(state.timeLeft<=0){clearInterval(state.timer);submitExam();}},1000);}
    async function goFullScreen(){if(document.documentElement.requestFullscreen){await document.documentElement.requestFullscreen();}}
    document.addEventListener("fullscreenchange",()=>{if(!document.fullscreenElement&&state.screen==="exam"){alert("Anda keluar dari mode full screen! Ujian dikunci.");state.locked=true;clearInterval(state.timer);render();}});

    function selectAnswer(i){if(!state.locked){state.answers[state.current]=i;render();}}
    function navigate(d){if(!state.locked){const n=state.current+d;if(n>=0&&n<questions.length)state.current=n;render();}}
    function calculateScore(){let correct=0;state.answers.forEach((ans,i)=>{if(ans===questions[i].correct)correct++;});return Math.round((correct/questions.length)*100);}
    function submitExam(){clearInterval(state.timer);const score=calculateScore();const correct=state.answers.filter((a,i)=>a===questions[i].correct).length;const data={name:state.studentName,class:state.studentClass,score,correct,total:questions.length,date:new Date().toLocaleString()};const saved=JSON.parse(localStorage.getItem('hasilUjian')||"[]");saved.push(data);localStorage.setItem('hasilUjian',JSON.stringify(saved));state.screen='result';state.finalScore=score;state.correct=correct;render();}

    function exportCSV(){const data=JSON.parse(localStorage.getItem('hasilUjian')||"[]");if(data.length===0){alert("Belum ada data tersimpan.");return;}let csv="Nama,Kelas,Nilai,Benar,Total,Waktu\n";data.forEach(d=>{csv+=`${d.name},${d.class},${d.score},${d.correct},${d.total},${d.date}\n`;});const blob=new Blob([csv],{type:"text/csv"});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download="hasil_ujian_informatika.csv";a.click();URL.revokeObjectURL(url);}
    function showGuruView(){const data=JSON.parse(localStorage.getItem('hasilUjian')||"[]");const app=document.getElementById('app');app.innerHTML=`<div class="min-h-full bg-sky-50 p-6"><h1 class="text-2xl font-bold mb-4 text-center">üìã Daftar Hasil Ujian</h1>${data.length===0?`<p class='text-center'>Belum ada data ujian.</p>`:`<div class='overflow-x-auto bg-white rounded-xl shadow p-4'><table class='w-full border text-sm'><thead class='bg-sky-100'><tr><th class='border px-2 py-1'>No</th><th class='border px-2 py-1'>Nama</th><th class='border px-2 py-1'>Kelas</th><th class='border px-2 py-1'>Nilai</th><th class='border px-2 py-1'>Benar</th><th class='border px-2 py-1'>Tanggal</th></tr></thead><tbody>${data.map((d,i)=>`<tr class='hover:bg-sky-50'><td class='border px-2 py-1 text-center'>${i+1}</td><td class='border px-2 py-1'>${d.name}</td><td class='border px-2 py-1 text-center'>${d.class}</td><td class='border px-2 py-1 text-center'>${d.score}</td><td class='border px-2 py-1 text-center'>${d.correct}/${d.total}</td><td class='border px-2 py-1 text-center'>${d.date}</td></tr>`).join('')}</tbody></table></div>`}<div class='flex justify-center gap-4 mt-6'><button id='export' class='bg-green-600 text-white px-5 py-2 rounded-lg font-semibold'>Ekspor CSV</button><button id='back' class='border border-sky-600 text-sky-700 px-5 py-2 rounded-lg font-semibold'>Kembali</button></div></div>`;document.getElementById('export').onclick=exportCSV;document.getElementById('back').onclick=()=>{state.screen='start';render();};}

    // ===================== RENDER =====================
    function render(){
      const app=document.getElementById('app'),s=config;
      if(state.screen==='start'){
        app.innerHTML=`<div class='flex h-full items-center justify-center bg-[${s.background_color}] p-4'><div class='max-w-md w-full bg-white p-8 rounded-2xl shadow-xl'><h1 class='text-2xl font-bold text-center mb-2'>${s.exam_title}</h1><p class='text-center mb-1'>${s.school_name}</p><p class='text-center mb-6'>${s.subject_info}</p><div class='mb-4'><label class='font-semibold'>Nama Siswa</label><input id='name' type='text' class='w-full border rounded-lg p-3 mt-2' placeholder='Nama lengkap'></div><div class='mb-6'><label class='font-semibold'>Kelas</label><select id='class' class='w-full border rounded-lg p-3 mt-2'><option value=''>Pilih Kelas</option><option>7.1</option><option>7.2</option><option>7.3</option><option>7.4</option><option>7.5</option><option>7.6</option><option>7.7</option></select></div><button id='start' class='w-full bg-blue-500 text-white py-3 rounded-lg font-bold hover:bg-blue-600'>Mulai Ujian</button><button id='guru' class='w-full mt-3 border border-amber-600 text-amber-700 py-2 rounded-lg font-semibold hover:bg-amber-50'>üë©‚Äçüè´ Mode Guru</button></div></div>`;
        document.getElementById('start').onclick=async()=>{
          const n=document.getElementById('name').value.trim();
          const c=document.getElementById('class').value;
          if(!n||!c)return alert('Isi nama dan kelas terlebih dahulu!');
          state.studentName=n;state.studentClass=c;
          shuffleQuestions(); // üîÄ acak soal & opsi di sini
          await goFullScreen();
          state.screen='exam';state.timeLeft=600;state.locked=false;
          startTimer();render();
        };
        document.getElementById('guru').onclick=()=>{const pin=prompt('Masukkan PIN Guru:');if(pin===s.guru_pin)showGuruView();else alert('PIN salah.');};
      }

      else if(state.screen==='exam'){
        const q=questions[state.current];
        app.innerHTML=`<div class='flex flex-col h-full bg-[${s.background_color}]'><div class='p-4 bg-white shadow flex justify-between items-center'><div><h2 class='font-bold'>${state.studentName}</h2><p class='text-sm'>Kelas ${state.studentClass} ‚Ä¢ Soal ${state.current+1}/${questions.length}</p></div><div class='text-right'><div id='timer' class='font-bold text-blue-600 text-xl'>${formatTime(state.timeLeft)}</div><p class='text-sm text-slate-600'>Waktu tersisa</p></div></div><div class='flex-1 overflow-y-auto p-4'>${state.locked?`<div class='text-center mt-20 text-red-600 font-bold text-xl'>Ujian dikunci karena keluar dari fullscreen.</div>`:`<div class='max-w-3xl mx-auto bg-white p-6 rounded-xl shadow question-card'><div class='flex mb-4'><span class='bg-blue-500 text-white px-3 py-1 rounded-lg mr-3 font-bold'>${state.current+1}</span><p class='font-semibold'>${q.question}</p></div><div class='space-y-3'>${q.options.map((opt,i)=>{const sel=state.answers[state.current]===i;return `<button class='option-button w-full text-left p-3 border-2 rounded-lg ${sel?'bg-green-500 text-white border-green-600':'border-slate-300'}' data-i='${i}'><span class='font-bold'>${String.fromCharCode(65+i)}.</span> ${opt}</button>`;}).join('')}</div></div><div class='flex justify-between mt-6'><button id='prev' class='px-4 py-2 rounded-lg border border-blue-600 text-blue-700 font-semibold ${state.current===0?'opacity-50 cursor-not-allowed':''}'>‚Üê Sebelumnya</button>${state.current===questions.length-1?`<button id='submit' class='px-6 py-2 bg-green-600 text-white font-bold rounded-lg'>Selesai & Kirim</button>`:`<button id='next' class='px-6 py-2 bg-blue-600 text-white font-bold rounded-lg'>Selanjutnya ‚Üí</button>`}</div>`}</div></div>`;
        document.querySelectorAll('[data-i]')?.forEach(b=>b.onclick=()=>selectAnswer(parseInt(b.dataset.i)));
        document.getElementById('prev')?.addEventListener('click',()=>navigate(-1));
        document.getElementById('next')?.addEventListener('click',()=>navigate(1));
        document.getElementById('submit')?.addEventListener('click',submitExam);
      }

      else if(state.screen==='result'){
        const g=state.finalScore>=90?'A':state.finalScore>=80?'B':state.finalScore>=70?'C':'D';
        const msg=g==='A'?'Luar biasa!':'Tetap semangat, belajar lagi ya!';
        app.innerHTML=`<div class='flex items-center justify-center h-full bg-[${s.background_color}] p-4'><div class='bg-white p-8 rounded-2xl shadow-xl text-center max-w-md w-full'><h1 class='text-2xl font-bold mb-3'>Ujian Selesai!</h1><p class='mb-6'>${msg}</p><div class='grid grid-cols-2 gap-4 mb-6'><div class='bg-blue-50 rounded-lg p-4'><div class='text-4xl font-bold text-blue-600'>${state.finalScore}</div><p>Nilai</p></div><div class='bg-green-50 rounded-lg p-4'><div class='text-4xl font-bold text-green-600'>${g}</div><p>Predikat</p></div></div><button id='finish' class='w-full bg-blue-600 text-white py-3 rounded-lg font-bold'>Tutup</button></div></div>`;
        document.getElementById('finish').onclick=()=>{document.exitFullscreen();state.screen='start';render();};
      }
    }

    render();
  </script>
</body>
</html>
